{"version":3,"sources":["webpack:///./app/javascript/mastodon/containers/media_container.jsx"],"names":["MEDIA_COMPONENTS","MediaGallery","Video","Card","Poll","Hashtag","Audio","MediaContainer","PureComponent","constructor","arguments","_defineProperty","media","index","lang","time","backgroundColor","options","document","body","classList","add","documentElement","style","marginRight","concat","getScrollbarWidth","this","setState","components","props","JSON","parse","componentIndex","getAttribute","mediaList","fromJS","remove","color","render","_this$state$options","_this$state$options2","_this$state$options3","handleOpenVideo","window","self","top","_jsx","IntlProvider","_jsxs","_Fragment","children","Array","from","map","component","i","componentName","Component","card","poll","hashtag","Object","assign","onOpenVideo","onOpenMedia","handleOpenMedia","createPortal","_createElement","key","ModalRoot","state","onClose","handleCloseMedia","MediaModal","currentTime","startTime","autoPlay","volume","defaultVolume","onChangeBackgroundColor","setBackgroundColor"],"mappings":"4RAiBA,MAAMA,EAAmB,CAAEC,uBAAcC,gBAAOC,SAAMC,SAAMC,YAASC,iBAEtD,MAAMC,UAAuBC,gBAAcC,cAAA,SAAAC,WAAAC,YAAA,aAMhD,CACNC,MAAO,KACPC,MAAO,KACPC,KAAM,KACNC,KAAM,KACNC,gBAAiB,KACjBC,QAAS,OACVN,YAAA,wBAEiB,CAACC,EAAOC,EAAOC,KAC/BI,SAASC,KAAKC,UAAUC,IAAI,uBAC5BH,SAASI,gBAAgBC,MAAMC,YAAW,GAAAC,OAAMC,cAAmB,MAEnEC,KAAKC,SAAS,CAAEhB,QAAOC,QAAOC,QAAO,IACtCH,YAAA,wBAEiB,CAACG,EAAMG,KACvB,MAAM,WAAEY,GAAeF,KAAKG,OACtB,MAAElB,GAAUmB,KAAKC,MAAMH,EAAWZ,EAAQgB,gBAAgBC,aAAa,eACvEC,EAAYC,iBAAOxB,GAEzBM,SAASC,KAAKC,UAAUC,IAAI,uBAC5BH,SAASI,gBAAgBC,MAAMC,YAAW,GAAAC,OAAMC,cAAmB,MAEnEC,KAAKC,SAAS,CAAEhB,MAAOuB,EAAWrB,OAAMG,WAAU,IACnDN,YAAA,yBAEkB,KACjBO,SAASC,KAAKC,UAAUiB,OAAO,uBAC/BnB,SAASI,gBAAgBC,MAAMC,YAAc,IAE7CG,KAAKC,SAAS,CACZhB,MAAO,KACPC,MAAO,KACPE,KAAM,KACNC,gBAAiB,KACjBC,QAAS,MACT,IACHN,YAAA,2BAEoB2B,IACnBX,KAAKC,SAAS,CAAEZ,gBAAiBsB,GAAQ,GAC1C,CAEDC,SAAW,IAADC,EAAAC,EAAAC,EACR,MAAM,WAAEb,GAAeF,KAAKG,MAE5B,IAAIa,EAOJ,OAJIC,OAAOC,OAASD,OAAOE,MACzBH,EAAkBhB,KAAKgB,iBAIvBI,YAACC,IAAY,UACXC,eAAAC,WAAA,CAAAC,SAAA,CACGC,MAAMC,KAAKxB,GAAYyB,KAAI,CAACC,EAAWC,KACtC,MAAMC,EAAgBF,EAAUrB,aAAa,kBACvCwB,EAAY1D,EAAiByD,IAC7B,MAAE7C,EAAK,KAAE+C,EAAI,KAAEC,EAAI,QAAEC,KAAY/B,GAAUC,KAAKC,MAAMuB,EAAUrB,aAAa,eAgBnF,OAdA4B,OAAOC,OAAOjC,EAAO,IACflB,EAAU,CAAEA,MAASwB,iBAAOxB,IAAa,CAAC,KAC1C+C,EAAU,CAAEA,KAASvB,iBAAOuB,IAAa,CAAC,KAC1CC,EAAU,CAAEA,KAASxB,iBAAOwB,IAAa,CAAC,KAC1CC,EAAU,CAAEA,QAASzB,iBAAOyB,IAAa,CAAC,KAExB,UAAlBJ,EAA4B,CAC9BxB,eAAgBuB,EAChBQ,YAAarB,GACX,CACFsB,YAAatC,KAAKuC,mBAIfC,uBACLC,wBAACV,EAAS,IAAK5B,EAAOuC,IAAG,SAAA5C,OAAW+B,KACpCD,EACD,IAGHR,YAACuB,IAAS,CAACtD,gBAAiBW,KAAK4C,MAAMvD,gBAAiBwD,QAAS7C,KAAK8C,uBAAiB,EACpF9C,KAAK4C,MAAM3D,OACVmC,YAAC2B,IAAU,CACT9D,MAAOe,KAAK4C,MAAM3D,MAClBC,MAAOc,KAAK4C,MAAM1D,OAAS,EAC3BC,KAAMa,KAAK4C,MAAMzD,KACjB6D,YAA+B,QAApBnC,EAAEb,KAAK4C,MAAMtD,eAAO,IAAAuB,OAAA,EAAlBA,EAAoBoC,UACjCC,SAA4B,QAApBpC,EAAEd,KAAK4C,MAAMtD,eAAO,IAAAwB,OAAA,EAAlBA,EAAoBoC,SAC9BC,OAA0B,QAApBpC,EAAEf,KAAK4C,MAAMtD,eAAO,IAAAyB,OAAA,EAAlBA,EAAoBqC,cAC5BP,QAAS7C,KAAK8C,iBACdO,wBAAyBrD,KAAKsD,yBAO5C,E","file":"js/containers/media_container-75755d85891ddc6e1d0b.chunk.js","sourcesContent":["import PropTypes from 'prop-types';\nimport { PureComponent } from 'react';\nimport { createPortal } from 'react-dom';\n\nimport { fromJS } from 'immutable';\n\nimport { ImmutableHashtag as Hashtag } from 'mastodon/components/hashtag';\nimport MediaGallery from 'mastodon/components/media_gallery';\nimport ModalRoot from 'mastodon/components/modal_root';\nimport Poll from 'mastodon/components/poll';\nimport Audio from 'mastodon/features/audio';\nimport Card from 'mastodon/features/status/components/card';\nimport MediaModal from 'mastodon/features/ui/components/media_modal';\nimport Video from 'mastodon/features/video';\nimport { IntlProvider } from 'mastodon/locales';\nimport { getScrollbarWidth } from 'mastodon/utils/scrollbar';\n\nconst MEDIA_COMPONENTS = { MediaGallery, Video, Card, Poll, Hashtag, Audio };\n\nexport default class MediaContainer extends PureComponent {\n\n  static propTypes = {\n    components: PropTypes.object.isRequired,\n  };\n\n  state = {\n    media: null,\n    index: null,\n    lang: null,\n    time: null,\n    backgroundColor: null,\n    options: null,\n  };\n\n  handleOpenMedia = (media, index, lang) => {\n    document.body.classList.add('with-modals--active');\n    document.documentElement.style.marginRight = `${getScrollbarWidth()}px`;\n\n    this.setState({ media, index, lang });\n  };\n\n  handleOpenVideo = (lang, options) => {\n    const { components } = this.props;\n    const { media } = JSON.parse(components[options.componentIndex].getAttribute('data-props'));\n    const mediaList = fromJS(media);\n\n    document.body.classList.add('with-modals--active');\n    document.documentElement.style.marginRight = `${getScrollbarWidth()}px`;\n\n    this.setState({ media: mediaList, lang, options });\n  };\n\n  handleCloseMedia = () => {\n    document.body.classList.remove('with-modals--active');\n    document.documentElement.style.marginRight = '0';\n\n    this.setState({\n      media: null,\n      index: null,\n      time: null,\n      backgroundColor: null,\n      options: null,\n    });\n  };\n\n  setBackgroundColor = color => {\n    this.setState({ backgroundColor: color });\n  };\n\n  render () {\n    const { components } = this.props;\n\n    let handleOpenVideo;\n\n    // Don't offer to expand the video in a lightbox if we're in a frame\n    if (window.self === window.top) {\n      handleOpenVideo = this.handleOpenVideo;\n    }\n\n    return (\n      <IntlProvider>\n        <>\n          {Array.from(components).map((component, i) => {\n            const componentName = component.getAttribute('data-component');\n            const Component = MEDIA_COMPONENTS[componentName];\n            const { media, card, poll, hashtag, ...props } = JSON.parse(component.getAttribute('data-props'));\n\n            Object.assign(props, {\n              ...(media   ? { media:   fromJS(media)   } : {}),\n              ...(card    ? { card:    fromJS(card)    } : {}),\n              ...(poll    ? { poll:    fromJS(poll)    } : {}),\n              ...(hashtag ? { hashtag: fromJS(hashtag) } : {}),\n\n              ...(componentName === 'Video' ? {\n                componentIndex: i,\n                onOpenVideo: handleOpenVideo,\n              } : {\n                onOpenMedia: this.handleOpenMedia,\n              }),\n            });\n\n            return createPortal(\n              <Component {...props} key={`media-${i}`} />,\n              component,\n            );\n          })}\n\n          <ModalRoot backgroundColor={this.state.backgroundColor} onClose={this.handleCloseMedia}>\n            {this.state.media && (\n              <MediaModal\n                media={this.state.media}\n                index={this.state.index || 0}\n                lang={this.state.lang}\n                currentTime={this.state.options?.startTime}\n                autoPlay={this.state.options?.autoPlay}\n                volume={this.state.options?.defaultVolume}\n                onClose={this.handleCloseMedia}\n                onChangeBackgroundColor={this.setBackgroundColor}\n              />\n            )}\n          </ModalRoot>\n        </>\n      </IntlProvider>\n    );\n  }\n\n}\n"],"sourceRoot":""}