{"version":3,"sources":["webpack:///./app/javascript/mastodon/features/firehose/index.jsx"],"names":["messages","defineMessages","title","id","defaultMessage","ColumnSettings","dispatch","useAppDispatch","settings","useAppSelector","state","getIn","onChange","useCallback","key","checked","changeSetting","_jsx","className","SettingToggle","settingPath","label","FormattedMessage","Firehose","_ref","feedType","multiColumn","intl","useIntl","signedIn","initialState","meta","me","accountId","disabledAccountId","disabled_account_id","accessToken","access_token","permissions","role","columnRef","useRef","onlyMedia","hasUnread","concat","handlePin","addColumn","other","onlyRemote","handleLoadMore","maxId","expandCommunityTimeline","expandPublicTimeline","handleHeaderClick","_columnRef$current","current","scrollTop","useEffect","disconnect","connectCommunityStream","connectPublicStream","_disconnect","prependBanner","DismissableBanner","values","domain","emptyMessage","_jsxs","Column","bindToDocument","ref","formatMessage","children","ColumnHeader","icon","iconComponent","PublicIcon","active","onPin","onClick","NavLink","exact","to","tagName","StatusListContainer","prepend","timelineId","onLoadMore","trackScroll","scrollKey","Helmet","name","content"],"mappings":"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","file":"js/features/firehose-bc224d72df9916a02976.chunk.js","sourcesContent":["import PropTypes from 'prop-types';\nimport { useRef, useCallback, useEffect } from 'react';\n\nimport { useIntl, defineMessages, FormattedMessage } from 'react-intl';\n\nimport { Helmet } from 'react-helmet';\nimport { NavLink } from 'react-router-dom';\n\nimport PublicIcon from '@/material-icons/400-24px/public.svg?react';\nimport { addColumn } from 'mastodon/actions/columns';\nimport { changeSetting } from 'mastodon/actions/settings';\nimport { connectPublicStream, connectCommunityStream } from 'mastodon/actions/streaming';\nimport { expandPublicTimeline, expandCommunityTimeline } from 'mastodon/actions/timelines';\nimport { DismissableBanner } from 'mastodon/components/dismissable_banner';\nimport initialState, { domain } from 'mastodon/initial_state';\nimport { useAppDispatch, useAppSelector } from 'mastodon/store';\n\nimport Column from '../../components/column';\nimport ColumnHeader from '../../components/column_header';\nimport SettingToggle from '../notifications/components/setting_toggle';\nimport StatusListContainer from '../ui/containers/status_list_container';\n\nconst messages = defineMessages({\n  title: { id: 'column.firehose', defaultMessage: 'Live feeds' },\n});\n\n// TODO: use a proper React context later on\nconst useIdentity = () => ({\n  signedIn: !!initialState.meta.me,\n  accountId: initialState.meta.me,\n  disabledAccountId: initialState.meta.disabled_account_id,\n  accessToken: initialState.meta.access_token,\n  permissions: initialState.role ? initialState.role.permissions : 0,\n});\n\nconst ColumnSettings = () => {\n  const dispatch = useAppDispatch();\n  const settings = useAppSelector((state) => state.getIn(['settings', 'firehose']));\n  const onChange = useCallback(\n    (key, checked) => dispatch(changeSetting(['firehose', ...key], checked)),\n    [dispatch],\n  );\n\n  return (\n    <div className='column-settings'>\n      <section>\n        <div className='column-settings__row'>\n          <SettingToggle\n            settings={settings}\n            settingPath={['onlyMedia']}\n            onChange={onChange}\n            label={<FormattedMessage id='community.column_settings.media_only' defaultMessage='Media only' />}\n          />\n        </div>\n      </section>\n    </div>\n  );\n};\n\nconst Firehose = ({ feedType, multiColumn }) => {\n  const dispatch = useAppDispatch();\n  const intl = useIntl();\n  const { signedIn } = useIdentity();\n  const columnRef = useRef(null);\n\n  const onlyMedia = useAppSelector((state) => state.getIn(['settings', 'firehose', 'onlyMedia'], false));\n  const hasUnread = useAppSelector((state) => state.getIn(['timelines', `${feedType}${onlyMedia ? ':media' : ''}`, 'unread'], 0) > 0);\n\n  const handlePin = useCallback(\n    () => {\n      switch(feedType) {\n      case 'community':\n        dispatch(addColumn('COMMUNITY', { other: { onlyMedia } }));\n        break;\n      case 'public':\n        dispatch(addColumn('PUBLIC', { other: { onlyMedia } }));\n        break;\n      case 'public:remote':\n        dispatch(addColumn('REMOTE', { other: { onlyMedia, onlyRemote: true } }));\n        break;\n      }\n    },\n    [dispatch, onlyMedia, feedType],\n  );\n\n  const handleLoadMore = useCallback(\n    (maxId) => {\n      switch(feedType) {\n      case 'community':\n        dispatch(expandCommunityTimeline({ maxId, onlyMedia }));\n        break;\n      case 'public':\n        dispatch(expandPublicTimeline({ maxId, onlyMedia }));\n        break;\n      case 'public:remote':\n        dispatch(expandPublicTimeline({ maxId, onlyMedia, onlyRemote: true }));\n        break;\n      }\n    },\n    [dispatch, onlyMedia, feedType],\n  );\n\n  const handleHeaderClick = useCallback(() => columnRef.current?.scrollTop(), []);\n\n  useEffect(() => {\n    let disconnect;\n\n    switch(feedType) {\n    case 'community':\n      dispatch(expandCommunityTimeline({ onlyMedia }));\n      if (signedIn) {\n        disconnect = dispatch(connectCommunityStream({ onlyMedia }));\n      }\n      break;\n    case 'public':\n      dispatch(expandPublicTimeline({ onlyMedia }));\n      if (signedIn) {\n        disconnect = dispatch(connectPublicStream({ onlyMedia }));\n      }\n      break;\n    case 'public:remote':\n      dispatch(expandPublicTimeline({ onlyMedia, onlyRemote: true }));\n      if (signedIn) {\n        disconnect = dispatch(connectPublicStream({ onlyMedia, onlyRemote: true }));\n      }\n      break;\n    }\n\n    return () => disconnect?.();\n  }, [dispatch, signedIn, feedType, onlyMedia]);\n\n  const prependBanner = feedType === 'community' ? (\n    <DismissableBanner id='community_timeline'>\n      <FormattedMessage\n        id='dismissable_banner.community_timeline'\n        defaultMessage='These are the most recent public posts from people whose accounts are hosted by {domain}.'\n        values={{ domain }}\n      />\n    </DismissableBanner>\n  ) : (\n    <DismissableBanner id='public_timeline'>\n      <FormattedMessage\n        id='dismissable_banner.public_timeline'\n        defaultMessage='These are the most recent public posts from people on the social web that people on {domain} follow.'\n        values={{ domain }}\n      />\n    </DismissableBanner>\n  );\n\n  const emptyMessage = feedType === 'community' ? (\n    <FormattedMessage\n      id='empty_column.community'\n      defaultMessage='The local timeline is empty. Write something publicly to get the ball rolling!'\n    />\n  ) : (\n    <FormattedMessage\n      id='empty_column.public'\n      defaultMessage='There is nothing here! Write something publicly, or manually follow users from other servers to fill it up'\n    />\n  );\n\n  return (\n    <Column bindToDocument={!multiColumn} ref={columnRef} label={intl.formatMessage(messages.title)}>\n      <ColumnHeader\n        icon='globe'\n        iconComponent={PublicIcon}\n        active={hasUnread}\n        title={intl.formatMessage(messages.title)}\n        onPin={handlePin}\n        onClick={handleHeaderClick}\n        multiColumn={multiColumn}\n      >\n        <ColumnSettings />\n      </ColumnHeader>\n\n      <div className='account__section-headline'>\n        <NavLink exact to='/public/local'>\n          <FormattedMessage tagName='div' id='firehose.local' defaultMessage='This server' />\n        </NavLink>\n\n        <NavLink exact to='/public/remote'>\n          <FormattedMessage tagName='div' id='firehose.remote' defaultMessage='Other servers' />\n        </NavLink>\n\n        <NavLink exact to='/public'>\n          <FormattedMessage tagName='div' id='firehose.all' defaultMessage='All' />\n        </NavLink>\n      </div>\n\n      <StatusListContainer\n        prepend={prependBanner}\n        timelineId={`${feedType}${onlyMedia ? ':media' : ''}`}\n        onLoadMore={handleLoadMore}\n        trackScroll\n        scrollKey='firehose'\n        emptyMessage={emptyMessage}\n        bindToDocument={!multiColumn}\n      />\n\n      <Helmet>\n        <title>{intl.formatMessage(messages.title)}</title>\n        <meta name='robots' content='noindex' />\n      </Helmet>\n    </Column>\n  );\n};\n\nFirehose.propTypes = {\n  multiColumn: PropTypes.bool,\n  feedType: PropTypes.string,\n};\n\nexport default Firehose;\n"],"sourceRoot":""}